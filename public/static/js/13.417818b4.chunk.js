(this.webpackJsonp=this.webpackJsonp||[]).push([[13],{490:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(49),l=t(0),a=t(20);function i(e,n){var t=n.getPayload;return function(n){var i=n.variables,u=n.onError,o=Object(a.j)(),s=Object(r.useQuery)(e,{variables:i}),d=s.data,c=s.loading,m=s.previousData,p=s.refetch,f=s.error,v=Object(l.useMemo)((function(){return t(d)}),[JSON.stringify(d)]);return Object(l.useEffect)((function(){JSON.stringify(m),JSON.stringify(d);null!=f&&f.message&&(!1!==n.showSnackbarErrors&&o(a.i.showSnackbar({message:f.message,variant:"error"})),u(f.message))}),[n.onError,null==f?void 0:f.message]),{loading:c,data:v,refetch:p}}}},492:function(e,n,t){"use strict";t.d(n,"a",(function(){return b}));var r,l=t(9),a=t.n(l),i=t(71),u=t.n(i),o=t(49),s=t(72),d=t(0),c=t.n(d),m=t(165),p=t(52),f=t(20),v=Object(s.a)(r||(r=u()(["\n  query QueryAvailableRigs(\n    $dropzoneId: Int!\n    $userId: Int!\n  ) {\n    dropzone(id: $dropzoneId) {\n      id\n      dropzoneUser(userId: $userId) {\n        id\n        availableRigs {\n          id\n          make\n          model\n          canopySize\n          serial\n\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"])));function b(e){var n,t,r,l,i,u,s,b,g=Object(d.useState)(!1),y=a()(g,2),j=y[0],E=y[1],I=Object(f.k)((function(e){return e.global})),h=Object(o.useLazyQuery)(v),O=a()(h,2),z=O[0],k=O[1].data;return Object(d.useEffect)((function(){var n;e.userId&&e.dropzoneId&&z({variables:{dropzoneId:Number(null==(n=I.currentDropzone)?void 0:n.id),userId:Number(e.userId)}})}),[e.userId,e.dropzoneId]),Object(d.useEffect)((function(){var n,t,r;!e.value&&e.autoSelectFirst&&null!=k&&null!=(n=k.dropzone)&&null!=(t=n.dropzoneUser)&&null!=(r=t.availableRigs)&&r.length&&e.onSelect(k.dropzone.dropzoneUser.availableRigs[0])}),[e.autoSelectFirst,JSON.stringify(null==k||null==(n=k.dropzone)||null==(t=n.dropzoneUser)?void 0:t.availableRigs)]),c.a.createElement(m.a,{onDismiss:function(){return E(!1)},visible:j,anchor:c.a.createElement(p.b.Item,{onPress:function(){E(!0)},title:e.value?(null==(r=e.value)?void 0:r.make)+" "+(null==(l=e.value)?void 0:l.model)+" ("+((null==(i=e.value)?void 0:i.canopySize)||"?")+"sqft)":"Select rig",description:e.required?null:"Optional",left:function(){return c.a.createElement(p.b.Icon,{icon:"parachute"})}})},null==k||null==(u=k.dropzone)||null==(s=u.dropzoneUser)||null==(b=s.availableRigs)?void 0:b.map((function(n){return c.a.createElement(m.a.Item,{key:"rig-select-"+n.id,onPress:function(){E(!1),e.onSelect(n)},title:(null==n?void 0:n.make)+" "+(null==n?void 0:n.model)+" ("+(null==n?void 0:n.canopySize)+" sqft) "+(n.user?"":"[DROPZONE RIG]")})})))}},536:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return Z}));var r=t(9),l=t.n(r),a=t(71),i=t.n(a),u=t(11),o=t.n(u),s=t(49),d=t(0),c=t.n(d),m=t(311),p=t(111),f=t(116),v=t(169),b=t(20),g=t(6),y=t.n(g),j=t(22),E=t.n(j),I=t(80),h=t(1),O=t(52),z=t(221),k=t(302),S=t(303),T=t(72),x=t(489),w=t(245),N=t(170),F=t(2);var $=function(e){var n=e.items,t=e.selected,r=e.isDisabled,l=e.renderItemLabel,a=e.onChangeSelected,i=e.autoSelectFirst;return Object(d.useEffect)((function(){(!t||!t.length&&n.length&&i)&&a([n[0]])}),[JSON.stringify(t),JSON.stringify(n),i]),c.a.createElement(F.a,{style:{flex:1,flexDirection:"row",flexWrap:"wrap"}},n.map((function(e){return c.a.createElement(k.a,{mode:"outlined",style:{margin:1},disabled:r(e),selected:t.map((function(e){return e.id})).includes(e.id),onPress:function(){return a(1===t.length?[e]:Object(x.xorBy)(t,[e],(function(e){return e.id})))}},l(e))})))},P=t(490),D=t(249);var J,U,C=t(492),W=Object(T.a)(J||(J=i()(["\nquery QueryDropzoneUsersManifestDetails(\n  $dropzoneId: Int!\n  $dropzoneUserId: Int!\n) {\n  dropzone(id: $dropzoneId) {\n    id\n    name\n\n    dropzoneUser(id: $dropzoneUserId) {\n      id\n\n      user {\n        id\n        name\n        exitWeight\n        license {\n          id\n          name\n        }\n        rigs {\n          id\n          make\n          model\n          canopySize\n        }\n      }\n      role {\n        id\n        name\n      }\n      user {\n        id\n        name\n      }\n    }\n  }\n}\n"]))),R=Object(P.a)(W,{getPayload:function(e){var n;return null==e||null==(n=e.dropzone)?void 0:n.dropzoneUser}});function q(e){var n,t,r,l,a,i,u,o,s=e.dropzoneId,f=e.dropzoneUserId,v=e.onChangeRig,g=e.exitWeight,y=e.rigId,j=e.onChangeExitWeight,E=Object(b.k)((function(e){return e})).global,h=R({variables:{dropzoneUserId:f,dropzoneId:s}}),z=h.data,T=h.loading,w=null==z||null==(n=z.user)||null==(t=n.rigs)?void 0:t.find((function(e){var n=e.id;return Number(n)===y}));return Object(d.useEffect)((function(){var e;!g&&null!=z&&null!=(e=z.user)&&e.exitWeight&&j(Number(z.user.exitWeight))}),[null==z||null==(r=z.user)?void 0:r.exitWeight]),c.a.createElement(p.a,{style:{width:"100%"},elevation:3},c.a.createElement(m.a,{indeterminate:!0,color:E.theme.colors.accent,visible:T}),c.a.createElement(p.a.Title,{title:null==z?void 0:z.user.name,left:function(){return c.a.createElement(O.a.Icon,{icon:"account",size:24})}}),c.a.createElement(p.a.Content,null,c.a.createElement(S.a,{style:{marginBottom:8}}),c.a.createElement(I.a,{horizontal:!0},c.a.createElement(k.a,{style:{marginHorizontal:1},icon:"lock",mode:"outlined",disabled:!0},null==z||null==(l=z.role)?void 0:l.name),c.a.createElement(k.a,{style:{marginHorizontal:1},icon:"ticket-account",mode:"outlined",disabled:!0},null==z||null==(a=z.user)||null==(i=a.license)?void 0:i.name),w&&g&&w.canopySize?c.a.createElement(k.a,{style:{marginHorizontal:1},icon:"escalator-down",mode:"outlined",disabled:!0},(u=g,o=w.canopySize,Object(x.round)(2.20462*u/o,2).toFixed(2))):null),c.a.createElement(C.a,{userId:f,dropzoneId:s,onSelect:v,value:w,autoSelectFirst:!0}),c.a.createElement(D.a,{value:g?""+g:"",onChangeText:function(e){return j(Number(e))},keyboardType:"number-pad",label:"Exit weight",mode:"outlined"})))}function M(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function A(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?M(Object(t),!0).forEach((function(n){y()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):M(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var B=Object(T.a)(U||(U=i()(["\nquery DropzoneUsersAllowedJumpTypes(\n  $dropzoneId: Int!,\n  $userIds: [Int!]!\n) {\n  dropzone(id: $dropzoneId) {\n    id\n\n    allowedJumpTypes(userId: $userIds) {\n      id\n      name\n    }\n\n    ticketTypes(isPublic: true) {\n      id\n      name\n      cost\n\n      extras {\n        id\n        cost\n        name\n      }\n    }\n  }\n  jumpTypes {\n    id\n    name\n  }\n}\n\n"]))),G=Object(P.a)(B,{getPayload:function(e){var n,t;return{allowedJumpTypes:(null==e||null==(n=e.dropzone)?void 0:n.allowedJumpTypes)||[],ticketTypes:(null==e||null==(t=e.dropzone)?void 0:t.ticketTypes)||[],jumpTypes:(null==e?void 0:e.jumpTypes)||[]}}}),L=w.a.actions;function Q(){var e,n,t,r,a,i,u,o,s,c,m,f,v,g,y=Object(b.k)((function(e){return e.slotsMultipleForm})),j=Object(b.k)((function(e){return e.global})),h=Object(b.j)(),T=G({variables:{userIds:null==(e=y.fields.users)||null==(n=e.value)?void 0:n.map((function(e){return e.id})),dropzoneId:Number(null==j||null==(t=j.currentDropzone)?void 0:t.id)}}),w=T.data;T.loading,Object(N.a)("createUserSlot");return d.createElement(d.Fragment,null,d.createElement(O.b.Subheader,null,"Jump type"),d.createElement(p.a,{elevation:2,style:{marginBottom:16}},d.createElement(p.a.Content,null,d.createElement($,{autoSelectFirst:!0,items:Object(x.uniqBy)([].concat(E()((null==w?void 0:w.allowedJumpTypes)||[]),E()((null==w?void 0:w.jumpTypes)||[])),(function(e){return e.id}))||[],selected:y.fields.jumpType.value?[y.fields.jumpType.value]:[],renderItemLabel:function(e){return e.name},isDisabled:function(e){var n;return!(null!=w&&null!=(n=w.allowedJumpTypes)&&n.map((function(e){return e.id})).includes(e.id))},onChangeSelected:function(e){var n=l()(e,1)[0];return h(L.setField(["jumpType",n]))}}),d.createElement(z.a,{type:y.fields.jumpType.error?"error":"info"},y.fields.jumpType.error||""))),d.createElement(O.b.Subheader,null,"Ticket"),d.createElement(p.a,{elevation:2,style:{width:"100%"}},d.createElement(p.a.Content,null,d.createElement($,{autoSelectFirst:!0,items:(null==w?void 0:w.ticketTypes)||[],selected:y.fields.ticketType.value?[y.fields.ticketType.value]:[],renderItemLabel:function(e){return e.name},isDisabled:function(){return!1},onChangeSelected:function(e){var n=l()(e,1)[0];return h(L.setField(["ticketType",n]))}}),d.createElement(z.a,{type:y.fields.ticketType.error?"error":"info"},y.fields.ticketType.error||""),null!=y&&null!=(r=y.fields)&&null!=(a=r.ticketType)&&null!=(i=a.value)&&null!=(u=i.extras)&&u.length?d.createElement(O.b.Subheader,null,"Ticket addons"):null,d.createElement(I.a,{horizontal:!0,style:H.ticketAddons},null==y||null==(o=y.fields)||null==(s=o.ticketType)||null==(c=s.value)||null==(m=c.extras)?void 0:m.map((function(e){var n,t,r,l;return d.createElement(k.a,{selected:null==y||null==(n=y.fields)||null==(t=n.extras.value)?void 0:t.some((function(n){return n.id===e.id})),onPress:null!=y&&null!=(r=y.fields)&&null!=(l=r.extras.value)&&l.some((function(n){return n.id===e.id}))?function(){var n,t;return h(L.setField(["extras",null==y||null==(n=y.fields)||null==(t=n.extras.value)?void 0:t.filter((function(n){return n.id!==e.id}))]))}:function(){var n,t;return h(L.setField(["extras",[].concat(E()((null==y||null==(n=y.fields)||null==(t=n.extras)?void 0:t.value)||[]),[e])]))}},e.name+" ($"+e.cost+")")}))),d.createElement(z.a,{type:y.fields.extras.error?"error":"info"},y.fields.extras.error||""))),d.createElement(S.a,null),d.createElement(O.b.Subheader,null,"Group"),null==(f=y.fields)||null==(v=f.users)||null==(g=v.value)?void 0:g.map((function(e){return d.createElement(q,{dropzoneId:Number(j.currentDropzone.id),dropzoneUserId:Number(e.id),rigId:Number(e.rigId)||void 0,exitWeight:e.exitWeight,onChangeExitWeight:function(n){var t;return h(L.setField(["users",null==(t=y.fields.users.value)?void 0:t.map((function(t){return t.id===e.id?A(A({},e),{},{exitWeight:n}):t}))]))},onChangeRig:function(n){var t;return h(L.setField(["users",null==(t=y.fields.users.value)?void 0:t.map((function(t){return t.id===e.id?A(A({},e),{},{rigId:Number(n.id)}):t}))]))}})})))}var _,H=h.a.create({fields:{flex:1},field:{marginBottom:8},ticketAddons:{marginBottom:8}}),Y=t(40),V=Object(s.gql)(_||(_=i()(["\n  mutation CreateSlot(\n    $jumpTypeId: Int\n    $extraIds: [Int!]\n    $loadId: Int\n    $ticketTypeId: Int\n    $userGroup: [SlotUser!]!,\n  ) {\n    createSlots(\n      input: {\n        attributes: {\n          jumpTypeId: $jumpTypeId\n          extraIds: $extraIds\n          loadId: $loadId\n          ticketTypeId: $ticketTypeId\n          userGroup: $userGroup,\n        }\n      }\n    ) {\n      errors\n      fieldErrors {\n        field\n        message\n      }\n      slots {\n        id\n        groupNumber\n        jumpType {\n          id\n          name\n        }\n        extras {\n          id\n          name\n        }\n        exitWeight\n        load {\n          id\n          name\n          loadNumber\n          createdAt\n          dispatchAt\n          hasLanded\n          maxSlots\n          isFull\n          isOpen\n          plane {\n            id\n            name\n          }\n          gca {\n            id\n            user {\n              id\n              name\n            }\n          }\n          pilot {\n            id\n            user {\n              id\n              name\n            }\n          }\n          loadMaster {\n            id\n            user {\n              id\n              name\n            }\n          }\n          slots {\n            id\n            createdAt\n            user {\n              id\n              name\n            }\n            passengerName\n            passengerExitWeight\n            ticketType {\n              id\n              name\n              isTandem\n              altitude\n            }\n            jumpType {\n              id\n              name\n            }\n            extras {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function Z(e){var n,t,r,a,i,u=Object(b.j)(),g=Object(b.k)((function(e){return e.slotsMultipleForm})),y=Object(b.k)((function(e){return e.global})),j=Object(s.useMutation)(V),E=l()(j,2),I=E[0],h=E[1],O=Object(Y.useNavigation)(),z=Object(d.useCallback)((function(){var e,n,t=!1;return null!=(e=g.fields.jumpType.value)&&e.id||(t=!0,u(b.g.setFieldError(["jumpType","You must specify the type of jump"]))),null!=(n=g.fields.ticketType.value)&&n.id||(t=!0,u(b.g.setFieldError(["ticketType","You must select a ticket type to manifest"]))),!t}),[JSON.stringify(g.fields)]),k=Object(d.useCallback)((function(){var e,n,t,r,l,a,i,s,d,c,m,p,f,v,y,j;return o.a.async((function(E){for(;;)switch(E.prev=E.next){case 0:if(z()){E.next=2;break}return E.abrupt("return");case 2:return E.prev=2,E.next=5,o.a.awrap(I({variables:{jumpTypeId:Number(null==(e=g.fields.jumpType.value)?void 0:e.id),extraIds:null==(n=g.fields.extras)||null==(t=n.value)?void 0:t.map((function(e){var n=e.id;return Number(n)})),loadId:Number(null==(r=g.fields.load.value)?void 0:r.id),userGroup:g.fields.users.value}}));case 5:if(v=E.sent,null==(l=v.data)||null==(a=l.createSlot)||null==(i=a.fieldErrors)||i.map((function(e){var n=e.field,t=e.message;switch(n){case"jump_type":return u(b.g.setFieldError(["jumpType",t]));case"load":return u(b.g.setFieldError(["load",t]));case"credits":case"extras":case"extra_ids":return u(b.g.setFieldError(["extras",t]));case"ticket_type":return u(b.g.setFieldError(["ticketType",t]));case"rig":return u(b.g.setFieldError(["rig",t]));case"user":return u(b.g.setFieldError(["user",t]));case"exit_weight":return u(b.g.setFieldError(["exitWeight",t]))}})),null==v||null==(s=v.data)||null==(d=s.createSlots)||null==(c=d.errors)||!c.length){E.next=9;break}return E.abrupt("return",u(b.i.showSnackbar({message:null==v||null==(y=v.data)||null==(j=y.createSlots)?void 0:j.errors[0],variant:"error"})));case 9:null!=(m=v.data)&&null!=(p=m.createSlots)&&null!=(f=p.fieldErrors)&&f.length||O.navigate("Manifest",{screen:"DropzoneScreen"}),E.next=15;break;case 12:E.prev=12,E.t0=E.catch(2),u(b.i.showSnackbar({message:E.t0.message,variant:"error"}));case 15:case"end":return E.stop()}}),null,null,[[2,12]],Promise)}),[JSON.stringify(g.fields),I,e.onSuccess]);return c.a.createElement(v.a,null,c.a.createElement(m.a,{indeterminate:!0,visible:h.loading,color:y.theme.colors.accent}),c.a.createElement(p.a.Title,{title:"Manifest "+(null==g||null==(n=g.fields)||null==(t=n.users)||null==(r=t.value)?void 0:r.length)+" jumpers on Load #"+(null==(a=g.fields.load)||null==(i=a.value)?void 0:i.loadNumber)}),c.a.createElement(Q,null),c.a.createElement(f.a,{mode:"contained",style:{width:"100%",marginVertical:16},onPress:function(){return k()},loading:h.loading},"Save"))}}}]);
//# sourceMappingURL=13.417818b4.chunk.js.map