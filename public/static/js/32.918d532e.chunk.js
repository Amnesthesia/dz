(this.webpackJsonp=this.webpackJsonp||[]).push([[32],{408:function(e,n,t){"use strict";t.d(n,"a",(function(){return u}));var i=t(0),r=t.n(i),a=t(89),l=t(4),o=t(409),c=t(60);function u(e){var n=Object(o.a)().height,t=Object(c.h)((function(e){return e.global})).theme;return r.a.createElement(a.a,{style:[d.container,{backgroundColor:t.colors.surface,height:n-112},e.style],contentContainerStyle:[d.content,e.contentContainerStyle]},e.children)}var d=l.a.create({container:{flex:1},content:{paddingHorizontal:16,alignItems:"flex-start",flexGrow:1,paddingBottom:50}})},455:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var i=t(6),r=t.n(i),a=t(0),l=t(419),o=t(194),c=t(475),u=t.n(c),d=(t(476),t(468));function s(e){var n=a.useState(!1),t=r()(n,2),i=t[0],c=t[1];a.useCallback((function(){c(!1)}),[c]),a.useCallback((function(n){var t=n.date;c(!1),e.onChange(t.getTime()/1e3)}),[c,e.onChange]);return a.createElement(a.Fragment,null,a.createElement(l.a,{onDismiss:function(){return c(!1)},visible:i,anchor:a.createElement(o.a.Item,{onPress:function(){return c(!0)},disabled:!!e.disabled,title:e.label,description:e.timestamp?Object(d.a)(1e3*e.timestamp,"yyyy/MM/dd"):"No date selected",left:function(){return a.createElement(o.a.Icon,{icon:"calendar"})}})},a.createElement(u.a,{selectedDays:e.timestamp?[new Date(1e3*e.timestamp)]:[],onDayClick:function(n){e.onChange(n.getTime()/1e3),c(!1)}})))}},532:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return D}));var i,r=t(6),a=t.n(r),l=t(405),o=t.n(l),c=t(10),u=t.n(c),d=t(120),s=t(73),p=t(468),m=t(88),g=t(0),I=t.n(g),v=t(411),f=t(194),b=t(203),h=t(4),y=t(60),k=t(428),E=t(416),z=t(441),C=t(455);function O(e){var n,t,i,r,a,l,o,c,u=Object(z.a)("actAsRigInspector");return null!=(n=e.config)&&n.valueType&&"string"===(null==(t=e.config)?void 0:t.valueType)?I.a.createElement(k.a,{mode:"outlined",disabled:!u,style:{marginVertical:8},value:e.value,onChangeText:function(n){return e.onChange(n)},label:e.config.name||""}):null!=(i=e.config)&&i.valueType&&"boolean"===(null==(r=e.config)?void 0:r.valueType)?I.a.createElement(E.a.Item,{label:e.config.name||"",disabled:!u,style:{marginVertical:8},status:"true"===e.value?"checked":"unchecked",onPress:function(){return e.onChange("true"===e.value?"false":"true")}}):null!=(a=e.config)&&a.valueType&&"integer"===(null==(l=e.config)?void 0:l.valueType)?I.a.createElement(k.a,{disabled:!u,value:e.value,mode:"outlined",onChangeText:function(n){return e.onChange(n)},label:e.config.name||"",keyboardType:"number-pad",style:{marginVertical:8}}):null!=(o=e.config)&&o.valueType&&"date"===(null==(c=e.config)?void 0:c.valueType)?I.a.createElement(C.a,{disabled:!u,timestamp:Number(e.value),onChange:function(n){return e.onChange(n.toString())},label:e.config.name||""}):null}var j=Object(m.a)(i||(i=o()(["\n  query RigInspection($dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      rigInspectionChecklist {\n        checklistItems {\n          id\n          isRequired\n          name\n          valueType\n          description\n        }\n      }\n    }\n  }\n"])));function T(){var e,n,t,i,r=Object(y.h)((function(e){return e})),a=r.global,l=r.rigInspectionForm,o=Object(y.g)(),c=Object(d.useQuery)(j,{variables:{dropzoneId:Number(null==a||null==(e=a.currentDropzone)?void 0:e.id)}}),u=c.data;c.loading;return g.createElement(g.Fragment,null,null==u||null==(n=u.dropzone)||null==(t=n.rigInspectionChecklist)||null==(i=t.checklistItems)?void 0:i.map((function(e){var n=l.fields.find((function(n){return(null==n?void 0:n.checklistItem.id)===e.id}));return g.createElement(O,{config:e,value:(null==n?void 0:n.value)||"",onChange:function(t){return o(y.d.setItem({checklistItem:e,value:t,id:(null==n?void 0:n.id)||null}))}})})))}h.a.create({fields:{flex:1},field:{marginBottom:8}});var $,x,R,S=t(408),w=Object(m.a)($||($=o()(["\n  query RigInspections($dropzoneUserId: Int!, $dropzoneId: Int!) {\n    dropzone(id: $dropzoneId) {\n      id\n      dropzoneUser(id: $dropzoneUserId) {\n        id\n        rigInspections {\n          id\n          rig {\n            id\n          }\n          inspectedBy {\n            id\n            name\n          }\n          checklistValues {\n            id\n            value\n            checklistItem {\n              id\n              name\n              valueType\n              isRequired\n              description\n            }\n          }\n        }\n      }\n    }\n  }\n"]))),N=Object(m.a)(x||(x=o()(["\n  mutation CreateRigInspection(\n    $dropzoneId: Int,\n    $rigId: Int,\n  ) {\n    createRigInspection(input: {\n      attributes: {\n        dropzoneId: $dropzoneId,\n        rigId: $rigId,\n      }\n    }) {\n      rigInspection {\n        id\n        inspectedBy {\n          id\n          name\n        }\n        rig {\n          id\n        }\n        checklistValues {\n          id\n          value\n          checklistItem {\n            id\n            name\n            valueType\n            isRequired\n            description\n          }\n        }\n      }\n      fieldErrors {\n        field\n        message\n      }\n      errors\n    }\n  }\n"]))),M=Object(m.a)(R||(R=o()(["\n  mutation SetValue(\n    $checklistItemId: Int,\n    $rigInspectionId: Int,\n    $value: String,\n  ) {\n    updateChecklistValue(input: {\n      attributes: {\n        checklistItemId: $checklistItemId,\n        rigInspectionId: $rigInspectionId,\n        value: $value\n      }\n    }) {\n      checklistValue {\n        id,\n        value,\n        checklistItem {\n          id\n          name\n          valueType,\n          description\n        }\n      }\n      fieldErrors {\n        field\n        message\n      }\n      errors\n    }\n  }\n"])));function D(){var e,n,t,i,r=Object(y.h)((function(e){return e})),l=r.global,o=r.rigInspectionForm,c=Object(y.g)(),m=Object(s.useRoute)().params,I=m.rig,h=m.dropzoneUserId,k=Object(d.useQuery)(w,{variables:{dropzoneId:Number(l.currentDropzone.id),dropzoneUserId:h}}),E=k.data,C=(k.loading,Object(z.a)("actAsRigInspector")),O=Object(d.useMutation)(N),j=a()(O,1)[0],$=Object(d.useMutation)(M),x=a()($,1)[0];g.useEffect((function(){var e,n,t;if(null!=E&&null!=(e=E.dropzone)&&null!=(n=e.dropzoneUser)&&null!=(t=n.rigInspections)&&t.some((function(e){var n;return(null==(n=e.rig)?void 0:n.id.toString())===I.id.toString()}))){var i,r,a,l=null==E||null==(i=E.dropzone)||null==(r=i.dropzoneUser)||null==(a=r.rigInspections)?void 0:a.find((function(e){var n;return(null==(n=e.rig)?void 0:n.id)===I.id}));console.log({inspection:l}),c(y.d.setOriginal(l))}}),[JSON.stringify(null==E||null==(e=E.dropzone)||null==(n=e.dropzoneUser)?void 0:n.rigInspections)]);var R=g.useCallback((function(){var e,n,t,i,r;return u.a.async((function(a){for(;;)switch(a.prev=a.next){case 0:if(a.prev=0,n=null==(e=o.original)?void 0:e.id){a.next=7;break}return a.next=5,u.a.awrap(j({variables:{dropzoneId:Number(l.currentDropzone.id),rigId:Number(I.id)}}));case 5:r=a.sent,n=null==r||null==(t=r.data)||null==(i=t.createRigInspection)?void 0:i.rigInspection.id;case 7:return a.next=9,u.a.awrap(Promise.all(o.fields.map((function(e){return x({variables:{rigInspectionId:Number(n),checklistItemId:Number(e.checklistItem.id),value:e.value}})}))));case 9:a.next=14;break;case 11:a.prev=11,a.t0=a.catch(0),c(y.f.showSnackbar({message:a.t0.message,variant:"error"}));case 14:case"end":return a.stop()}}),null,null,[[0,11]],Promise)}),[JSON.stringify(o.fields),null==o||null==(t=o.original)?void 0:t.id,null==l||null==(i=l.currentDropzone)?void 0:i.id]);return g.createElement(S.a,null,g.createElement(v.a,{style:{width:"100%"}},g.createElement(v.a.Title,{title:"Rig"}),g.createElement(v.a.Content,null,g.createElement(f.a.Item,{title:"Make",description:I.make}),g.createElement(f.a.Item,{title:"Model",description:I.model}),g.createElement(f.a.Item,{title:"Serial",description:I.serial}),g.createElement(f.a.Item,{title:"Repack due",description:null!=I&&I.repackExpiresAt?Object(p.a)(1e3*I.repackExpiresAt,"yyyy/MM/dd"):"-"}))),g.createElement(v.a,{style:{width:"100%"}},g.createElement(v.a.Title,{title:"Inspection"}),g.createElement(v.a.Content,null,g.createElement(T,null)),g.createElement(v.a.Actions,null,g.createElement(b.a,{disabled:!C,mode:"contained",onPress:function(){return R()},style:{width:"100%"}},"Mark as inspected"))))}}}]);
//# sourceMappingURL=32.918d532e.chunk.js.map