(this.webpackJsonp=this.webpackJsonp||[]).push([[21],{483:function(e,n,r){"use strict";r.d(n,"a",(function(){return l}));var t=r(143),a=r(257),l=t.a.actions;a.a},491:function(e,n,r){"use strict";r.d(n,"a",(function(){return o}));var t=r(49),a=r(0),l=r(21);function o(e,n){var r=n.getPayload;return function(n){var o=n.variables,i=n.onError,s=Object(l.k)(),u=Object(t.useQuery)(e,{variables:o}),d=u.data,c=u.loading,m=u.previousData,f=u.refetch,p=u.error,v=Object(a.useMemo)((function(){return r(d)}),[JSON.stringify(d)]);return Object(a.useEffect)((function(){JSON.stringify(m),JSON.stringify(d);null!=p&&p.message&&(!1!==n.showSnackbarErrors&&s(l.j.showSnackbar({message:p.message,variant:"error"})),i(p.message))}),[n.onError,null==p?void 0:p.message]),{loading:c,data:v,refetch:f}}}},538:function(e,n,r){"use strict";r.r(n),r.d(n,"default",(function(){return V}));var t,a=r(9),l=r.n(a),o=r(71),i=r.n(o),s=r(11),u=r.n(s),d=r(0),c=r.n(d),m=r(1),f=r(116),p=r(49),v=r(21),b=r(40),g=r(36),E=r(483),S=r(112),h=r(231),O=r(2),I=r(250),y=r(221),x=r(222),z=r(304),j=r(72),k=r(165),F=r(52),w=Object(j.a)(t||(t=i()(["\n  query QueryPlanes(\n    $dropzoneId: Int!\n  ) {\n    planes(dropzoneId: $dropzoneId) {\n      id\n      name\n      registration\n      hours\n      minSlots\n      maxSlots\n      nextMaintenanceHours\n      createdAt\n    }\n  }\n"])));function N(e){var n,r,t,a=Object(d.useState)(!1),o=l()(a,2),i=o[0],s=o[1],u=Object(v.l)((function(e){return e.global})),m=Object(p.useQuery)(w,{variables:{dropzoneId:Number(null==(n=u.currentDropzone)?void 0:n.id)}}),f=m.data;m.loading,m.refetch;return c.a.createElement(k.a,{onDismiss:function(){return s(!1)},visible:i,anchor:c.a.createElement(F.b.Item,{onPress:function(){s(!0)},title:(null==(r=e.value)?void 0:r.name)||"No plane selected",description:e.required?null:"Optional",right:function(){return c.a.createElement(F.b.Icon,{icon:"airplane"})}})},null==f||null==(t=f.planes)?void 0:t.map((function(n){return c.a.createElement(k.a.Item,{key:"plane-select-"+n.id,onPress:function(){s(!1),e.onSelect(n)},title:n.name||"-"})})))}var $,P=r(129),q=r(491),D=Object(j.a)($||($=i()(["\nquery QueryDropzoneUsers(\n  $dropzoneId: Int!\n  $permissions: [Permission!]\n) {\n  dropzone(id: $dropzoneId) {\n    id\n    name\n\n    dropzoneUsers(permissions: $permissions) {\n      edges {\n        node {\n          id\n          role {\n            id\n            name\n          }\n          user {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n}\n"]))),C=Object(q.a)(D,{getPayload:function(e){var n;return null==e||null==(n=e.dropzone)?void 0:n.dropzoneUsers}});function L(e){var n,r,t,a,o,i=Object(d.useState)(!1),s=l()(i,2),u=s[0],m=s[1],f=Object(v.l)((function(e){return e.global})),p=C({variables:{dropzoneId:Number(null==(n=f.currentDropzone)?void 0:n.id),permissions:e.requiredPermissions}}),b=p.data;p.loading,p.refetch;return c.a.createElement(c.a.Fragment,null,c.a.createElement(P.a,null,e.label),c.a.createElement(k.a,{onDismiss:function(){return m(!1)},visible:u,anchor:c.a.createElement(F.b.Item,{onPress:function(){m(!0)},title:null!=(r=e.value)&&null!=(t=r.user)&&t.id?null==(a=e.value)?void 0:a.user.name:"No user selected",style:{width:"100%"},right:function(){return c.a.createElement(F.b.Icon,{icon:"account"})},description:e.required?null:"Optional"})},null==b||null==(o=b.edges)?void 0:o.map((function(n){var r,t;return c.a.createElement(k.a.Item,{key:"user-select-"+(null==n?void 0:n.node.id),style:{width:"100%"},onPress:function(){m(!1),e.onSelect(null==n?void 0:n.node)},title:(null==n||null==(r=n.node)||null==(t=r.user)?void 0:t.name)||"-"})}))))}var A=h.a.actions;function J(){var e,n,r,t,a,l=Object(v.l)((function(e){return e.loadForm})),o=Object(v.k)(),i=Object(v.l)((function(e){return e.global}));return d.createElement(d.Fragment,null,d.createElement(I.a,{style:M.field,mode:"outlined",label:"Name",error:!!l.fields.name.error,placeholder:"Optional",value:l.fields.name.value||"",autoFocus:!0,onChangeText:function(e){return o(A.setField(["name",e]))}}),d.createElement(y.a,{type:l.fields.name.error?"error":"info"},l.fields.name.error||"e.g Starcrest load, Tandem load"),d.createElement(I.a,{style:M.field,mode:"outlined",label:"Slots",error:!!l.fields.maxSlots.error,value:null==(e=l.fields.maxSlots)||null==(n=e.value)?void 0:n.toString(),onChangeText:function(e){return o(A.setField(["maxSlots",Number(e)]))}}),d.createElement(y.a,{type:l.fields.maxSlots.error?"error":"info"},l.fields.maxSlots.error||""),d.createElement(O.a,{style:{width:"100%"}},d.createElement(N,{value:l.fields.plane.value,required:!0,onSelect:function(e){o(A.setField(["plane",e])),o(A.setField(["maxSlots",e.maxSlots]))},dropzoneId:Number(null==(r=i.currentDropzone)?void 0:r.id)}),d.createElement(y.a,{type:l.fields.plane.error?"error":"info"},l.fields.plane.error||""),d.createElement(x.a.Item,{label:"Allow public manifesting",status:l.fields.isOpen.value?"checked":"unchecked",onPress:function(){return o(A.setField(["isOpen",!l.fields.isOpen.value]))}}),d.createElement(z.a,{style:{marginVertical:8}}),d.createElement(L,{label:"GCA",onSelect:function(e){return o(A.setField(["gca",e]))},dropzoneId:Number(null==(t=i.currentDropzone)?void 0:t.id),value:l.fields.gca.value||null,requiredPermissions:["actAsGCA"],required:!0}),d.createElement(y.a,{type:l.fields.gca.error?"error":"info"},l.fields.gca.error||""),d.createElement(L,{label:"Pilot",onSelect:function(e){return o(A.setField(["pilot",e]))},dropzoneId:Number(null==(a=i.currentDropzone)?void 0:a.id),value:l.fields.pilot.value||null,requiredPermissions:["actAsPilot"]}),d.createElement(y.a,{type:l.fields.pilot.error?"error":"info"},l.fields.pilot.error||"")))}var B,M=m.a.create({fields:{flex:1,width:"100%"},field:{marginBottom:8,width:"100%"}}),Q=r(169),T=r(352),G=h.a.actions,U=(S.a.actions,Object(p.gql)(B||(B=i()(["\n  mutation CreateLoad(\n    $name: String,\n    $pilotId: Int,\n    $gcaId: Int,\n    $maxSlots: Int!,\n    $planeId: Int,\n    $isOpen: Boolean,\n  ){\n    createLoad(input: {\n      attributes: {\n        name: $name,\n        pilotId: $pilotId,\n        gcaId: $gcaId,\n        maxSlots: $maxSlots,\n        planeId: $planeId,\n        isOpen: $isOpen,\n      }\n    }) {\n      load {\n        id\n        name\n        pilot {\n          id\n          user {\n            id \n            name\n          }\n        }\n        gca {\n          id\n          user {\n            id \n            name\n          }\n        }\n        maxSlots\n        isOpen\n      }\n      fieldErrors {\n        field,\n        message\n      }\n      errors\n    }\n  }\n"]))));function V(){var e=Object(v.l)((function(e){return e})),n=e.loadForm,r=e.global,t=Object(v.k)(),a=Object(b.useNavigation)(),o=Object(p.useMutation)(U),i=l()(o,2),s=i[0],c=i[1],m=d.useCallback((function(){var e=!1;return n.fields.maxSlots.value<1&&(e=!0,t(G.setFieldError(["maxSlots","Please specify amount of allowed jumpers"]))),n.fields.plane.value||(e=!0,t(G.setFieldError(["plane","What plane is flying this load?"]))),n.fields.gca.value||(e=!0,t(G.setFieldError(["gca","You must have a GCA for this load"]))),!e}),[JSON.stringify(n.fields),t]),S=d.useCallback((function(){var e,l,o,i,d,c,f,p,v,b,g,S,h,O,I,y,x,z,j,k,F,w,N,$,P,q,D,C;return u.a.async((function(L){for(;;)switch(L.prev=L.next){case 0:if(e=n.fields,l=e.name,o=e.gca,e.loadMaster,i=e.plane,d=e.maxSlots,c=e.pilot,f=e.isOpen,!m()){L.next=15;break}return L.prev=2,L.next=5,u.a.awrap(s({variables:{dropzoneId:Number(null==(p=r.currentDropzone)?void 0:p.id),name:l.value,maxSlots:d.value,planeId:null!=(v=i.value)&&v.id?Number(null==(b=i.value)?void 0:b.id):null,pilotId:null!=(g=c.value)&&g.id?Number(null==(S=i.value)?void 0:S.id):null,gcaId:null!=(h=o.value)&&null!=(O=h.user)&&O.id?Number(null==(I=o.value)||null==(y=I.user)?void 0:y.id):null,isOpen:!!f.value}}));case 5:if(P=L.sent,null==(x=P.data)||null==(z=x.createLoad)||null==(j=z.fieldErrors)||j.map((function(e){var n=e.field,r=e.message;switch(n){case"name":return t(G.setFieldError(["name",r]));case"maxSlots":return t(G.setFieldError(["maxSlots",r]));case"plane":return t(G.setFieldError(["plane",r]));case"gca":return t(G.setFieldError(["gca",r]));case"is_open":return t(G.setFieldError(["isOpen",r]));case"pilot":return t(G.setFieldError(["pilot",r]))}})),null==P||null==(k=P.data)||null==(F=k.createLoad)||null==(w=F.errors)||!w.length){L.next=9;break}return L.abrupt("return",t(E.a.showSnackbar({message:P.data.createLoad.errors[0],variant:"error"})));case 9:null!=(N=P.data)&&null!=($=N.createLoad)&&$.load&&(C=P.data.createLoad.load,t(E.a.showSnackbar({message:"Load "+C.name+" created",variant:"success"})),null!=(q=P.data)&&null!=(D=q.createLoad)&&D.fieldErrors||a.goBack()),L.next=15;break;case 12:L.prev=12,L.t0=L.catch(2),t(E.a.showSnackbar({message:L.t0.message,variant:"error"}));case 15:case"end":return L.stop()}}),null,null,[[2,12]],Promise)}),[JSON.stringify(n.fields),t,s]);return d.createElement(Q.a,{contentContainerStyle:H.content},d.createElement(T.a,{name:"airplane-takeoff",size:100,color:"#999999",style:{alignSelf:"center",marginTop:32}}),d.createElement(J,null),d.createElement(g.b,{style:H.fields},d.createElement(f.a,{mode:"contained",style:H.button,disabled:c.loading,onPress:S,loading:c.loading},"Save")))}var H=m.a.create({content:{paddingHorizontal:48},button:{},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"},fields:{marginVertical:16,width:"100%"},field:{marginBottom:8}})}}]);
//# sourceMappingURL=21.0ef41213.chunk.js.map