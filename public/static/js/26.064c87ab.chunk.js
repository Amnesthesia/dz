(this.webpackJsonp=this.webpackJsonp||[]).push([[26],{483:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var l=t(143),i=t(257),r=l.a.actions;i.a},540:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return A}));var l,i,r=t(9),a=t.n(r),o=t(71),u=t.n(o),s=t(11),d=t.n(s),c=t(0),m=t.n(c),f=t(1),g=t(116),v=t(49),h=t(21),p=t(36),b=t(483),E=t(112),x=t(232),F=t(2),y=t(250),S=t(221),O=t(304),j=t(72),k=t(52),w=t(165),I=Object(j.a)(l||(l=u()(["\n  query Licenses($federationId: Int) {\n    licenses(federationId: $federationId) {\n      id\n      name\n\n      federation {\n        id\n        name\n      }\n\n    }\n  }\n"])));function W(e){var n,t,l=Object(c.useState)(!1),i=a()(l,2),r=i[0],o=i[1],u=(Object(h.l)((function(e){return e.global})),Object(v.useQuery)(I,{variables:{federationId:e.federationId}})),s=u.data;u.loading,u.refetch;return m.a.createElement(m.a.Fragment,null,m.a.createElement(k.b.Subheader,null,"License"),m.a.createElement(w.a,{onDismiss:function(){return o(!1)},visible:r,anchor:m.a.createElement(k.b.Item,{onPress:function(){o(!0)},title:(null==(n=e.value)?void 0:n.name)||"Please select a license",description:e.required?null:"Optional"})},null==s||null==(t=s.licenses)?void 0:t.map((function(n){return m.a.createElement(w.a.Item,{key:"license-select-"+n.id,onPress:function(){o(!1),e.onSelect(n)},title:n.name||"-"})}))))}var $=Object(j.a)(i||(i=u()(["\n  query Federations {\n    federations {\n      id\n      name\n    }\n  }\n"])));function P(e){var n,t,l=Object(c.useState)(!1),i=a()(l,2),r=i[0],o=i[1],u=Object(v.useQuery)($).data;return Object(c.useEffect)((function(){var n;1!==(null==u||null==(n=u.federations)?void 0:n.length)||e.value||e.onSelect(u.federations[0])}),[JSON.stringify(null==u?void 0:u.federations)]),m.a.createElement(m.a.Fragment,null,m.a.createElement(k.b.Subheader,null,"Federation"),m.a.createElement(w.a,{onDismiss:function(){return o(!1)},visible:r,anchor:m.a.createElement(k.b.Item,{onPress:function(){o(!0)},title:(null==(n=e.value)?void 0:n.name)||"Please select federation",description:e.required?null:"Optional"})},null==u||null==(t=u.federations)?void 0:t.map((function(n){return m.a.createElement(w.a.Item,{onPress:function(){o(!1),e.onSelect(n)},title:n.name||"-",key:"federation-select-"+n.id})}))))}var N=x.a.actions;function T(){var e,n,t,l,i,r,a,o,u,s,d,m,f,g,v,p,b,E,x,j,k,w,I,$,T,q,U,z=Object(h.l)((function(e){return e.userForm})),B=Object(h.k)(),J=Object(h.l)((function(e){return e.global}));c.useEffect((function(){var e;z.original&&(z.fields.exitWeight.value||B(N.setField(["exitWeight",z.original.exitWeight||"60"])),!z.fields.rigs.value&&null!=(e=z.original)&&e.id&&B(N.setField(["rigs",z.original.rigs])))}),[null==(e=z.original)?void 0:e.id]);null==z||null==(n=z.original)||n.id,null==z||null==(t=z.original)||t.id,null==(l=J.currentUser)||l.id;return c.createElement(c.Fragment,null,c.createElement(y.a,{style:C.field,mode:"outlined",label:"Name",error:!!z.fields.name.error,value:(null==(i=z.fields.name)||null==(r=i.value)?void 0:r.toString())||"",onChangeText:function(e){return B(N.setField(["name",e]))}}),c.createElement(S.a,{type:z.fields.name.error?"error":"info"},z.fields.name.error||" "),c.createElement(y.a,{style:C.field,mode:"outlined",label:"Email",error:!!z.fields.email.error,value:(null==(a=z.fields.email)||null==(o=a.value)?void 0:o.toString())||"",onChangeText:function(e){return B(N.setField(["email",e]))}}),c.createElement(S.a,{type:z.fields.email.error?"error":"info"},z.fields.email.error||" "),c.createElement(y.a,{style:C.field,mode:"outlined",label:"Phone",error:!!z.fields.phone.error,value:(null==(u=z.fields.phone)||null==(s=u.value)?void 0:s.toString())||"",onChangeText:function(e){return B(N.setField(["phone",e]))}}),c.createElement(S.a,{type:z.fields.phone.error?"error":"info"},z.fields.phone.error||""),c.createElement(y.a,{style:C.field,mode:"outlined",label:"Exit weight",error:!!z.fields.exitWeight.error,value:(null==(d=z.fields.exitWeight)||null==(m=d.value)?void 0:m.toString())||"",keyboardType:"numbers-and-punctuation",right:function(){return c.createElement(y.a.Affix,{text:"kg"})},onChangeText:function(e){return B(N.setField(["exitWeight",e]))}}),c.createElement(S.a,{type:z.fields.exitWeight.error?"error":"info"},z.fields.exitWeight.error||""),c.createElement(O.a,null),c.createElement(F.a,{style:{width:"100%"}},c.createElement(P,{value:(null==z||null==(f=z.fields)||null==(g=f.license)||null==(v=g.value)?void 0:v.federation)||z.federation.value,onSelect:function(e){return B(N.setFederation(e))},required:!0}),c.createElement(S.a,{type:z.federation.error?"error":"info"},z.federation.error||""),((null==z||null==(p=z.fields)||null==(b=p.license)||null==(E=b.value)||null==(x=E.federation)?void 0:x.id)||(null==z||null==(j=z.federation)||null==(k=j.value)?void 0:k.id))&&c.createElement(c.Fragment,null,c.createElement(W,{value:z.fields.license.value,federationId:Number((null==z||null==(w=z.fields)||null==(I=w.license)||null==($=I.value)||null==(T=$.federation)?void 0:T.id)||(null==(q=z.federation)||null==(U=q.value)?void 0:U.id)),onSelect:function(e){return B(N.setField(["license",e]))},required:!0}),c.createElement(S.a,{type:z.fields.license.error?"error":"info"},z.fields.license.error||""))))}var q,C=f.a.create({fields:{flex:1,width:"100%",paddingTop:32},field:{marginBottom:8,width:"100%"},ticketAddons:{marginBottom:8}}),U=t(40),z=t(169),B=x.a.actions,J=(E.a.actions,Object(v.gql)(q||(q=u()(["\n  mutation UpdateUser(\n    $id: Int,\n    $name: String,\n    $phone: String,\n    $email: String,\n    $licenseId: Int,\n    $exitWeight: Float,\n  ){\n    updateUser(input: {\n      id: $id\n      attributes: {\n        name: $name,\n        phone: $phone,\n        email: $email,\n        licenseId: $licenseId,\n        exitWeight: $exitWeight,\n      }\n    }) {\n      user {\n        id\n        name\n        exitWeight\n        email\n        phone\n        rigs {\n          id\n          model\n          make\n          serial\n          canopySize\n        }\n        jumpTypes {\n          id\n          name\n        }\n        license {\n          id\n          name\n\n          federation {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"]))));function A(){var e=Object(h.l)((function(e){return e})),n=e.userForm,t=(e.global,Object(h.k)()),l=Object(U.useNavigation)(),i=Object(U.useRoute)().params.user;c.useEffect((function(){t(B.setOriginal(i))}),[null==i?void 0:i.id]);var r=Object(v.useMutation)(J),o=a()(r,2),u=o[0],s=o[1],m=c.useCallback((function(){var e,l,i,r,a,o,u,s,d,c=!1,m=new RegExp(/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);return((null==(e=n.fields.name)||null==(l=e.value)?void 0:l.length)||0)<3&&(c=!0,t(B.setFieldError(["name","Name is too short"]))),((null==(i=n.fields.email)||null==(r=i.value)?void 0:r.length)||0)<3&&(c=!0,t(B.setFieldError(["email","Email is too short"]))),((null==(a=n.fields.phone)||null==(o=a.value)?void 0:o.length)||0)<3&&(c=!0,t(B.setFieldError(["phone","Phone number is too short"]))),m.test((null==(u=n.fields)||null==(s=u.email)?void 0:s.value)||"")||(c=!0,t(B.setFieldError(["email","Please enter a valid email"]))),((null==(d=n.fields.exitWeight)?void 0:d.value)||0)<30&&(c=!0,t(B.setFieldError(["exitWeight","Exit weight seems too low?"]))),!c}),[JSON.stringify(n.fields),t]),f=c.useCallback((function(){var e,i,r,a,o,s,c,f,g,v,p,E,x;return d.a.async((function(F){for(;;)switch(F.prev=F.next){case 0:if(e=n.fields,i=e.name,r=e.license,a=e.phone,o=e.email,s=e.exitWeight,!m()){F.next=12;break}return F.prev=2,F.next=5,d.a.awrap(u({variables:{id:Number(n.original.id),name:i.value,licenseId:null!=(c=r.value)&&c.id?Number(r.value.id):null,phone:a.value,exitWeight:parseFloat(s.value),email:o.value}}));case 5:v=F.sent,null!=(f=v.data)&&null!=(g=f.updateUser)&&g.user&&(p=v.data.updateUser,E=p.fieldErrors,x=p.errors,E?null==E||E.map((function(e){var n=e.field,l=e.message;switch(n){case"name":return t(h.m.setFieldError(["name",l]));case"exit_weight":return t(h.m.setFieldError(["exitWeight",l]));case"license_id":return t(h.m.setFieldError(["license",l]));case"phone":return t(h.m.setFieldError(["phone",l]));case"email":return t(h.m.setFieldError(["email",l]))}})):null!=x&&x.length?x.map((function(e){return t(b.a.showSnackbar({message:e,variant:"error"}))})):(t(b.a.showSnackbar({message:"Profile has been updated",variant:"success"})),l.goBack(),t(h.m.reset()))),F.next=12;break;case 9:F.prev=9,F.t0=F.catch(2),t(b.a.showSnackbar({message:F.t0.message,variant:"error"}));case 12:case"end":return F.stop()}}),null,null,[[2,9]],Promise)}),[JSON.stringify(n.fields),t,u]);return c.createElement(z.a,{contentContainerStyle:{paddingHorizontal:48}},c.createElement(T,null),c.createElement(p.b,{style:D.fields},c.createElement(g.a,{mode:"contained",disabled:s.loading,onPress:f,loading:s.loading},"Save")))}var D=f.a.create({container:{flex:1,alignItems:"center",paddingTop:56},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"},fields:{width:"100%",marginBottom:16},field:{marginBottom:8}})}}]);
//# sourceMappingURL=26.064c87ab.chunk.js.map