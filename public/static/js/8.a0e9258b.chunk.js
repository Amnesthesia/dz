(this.webpackJsonp=this.webpackJsonp||[]).push([[8],{482:function(e,n,t){"use strict";function l(e,n){if(n.length<e)throw new TypeError(e+" argument"+(e>1?"s":"")+" required, but only "+n.length+" present")}t.d(n,"a",(function(){return l}))},484:function(e,n,t){"use strict";t.d(n,"a",(function(){return r}));var l=t(482);function r(e){Object(l.a)(1,arguments);var n=Object.prototype.toString.call(e);return e instanceof Date||"object"===typeof e&&"[object Date]"===n?new Date(e.getTime()):"number"===typeof e||"[object Number]"===n?new Date(e):("string"!==typeof e&&"[object String]"!==n||"undefined"===typeof console||(console.warn("Starting with v2.0.0-beta.1 date-fns doesn't accept strings as date arguments. Please use `parseISO` to parse strings. See: https://git.io/fjule"),console.warn((new Error).stack)),new Date(NaN))}},486:function(e,n,t){"use strict";t.d(n,"a",(function(){return s}));var l=t(0),r=t.n(l),a=t(1),i=t(129),o=t(302),u=t(36);function s(e){var n=e.title,t=e.subtitle;return r.a.createElement(u.b,{style:d.empty},r.a.createElement(i.a,null,n),r.a.createElement(o.a,{style:{textAlign:"center"}},t))}var d=a.a.create({container:{flex:1,padding:8,display:"flex"},fab:{position:"absolute",margin:16,right:0,bottom:0},empty:{flex:1,alignItems:"center",justifyContent:"center",width:"100%",height:"100%"}})},487:function(e,n,t){"use strict";function l(e){if(null===e||!0===e||!1===e)return NaN;var n=Number(e);return isNaN(n)?n:n<0?Math.ceil(n):Math.floor(n)}t.d(n,"a",(function(){return l}))},494:function(e,n,t){"use strict";t.d(n,"a",(function(){return b}));var l,r=t(9),a=t.n(r),i=t(71),o=t.n(i),u=t(49),s=t(72),d=t(0),c=t.n(d),m=t(165),p=t(52),f=t(21),v=Object(s.a)(l||(l=o()(["\n  query QueryAvailableRigs(\n    $dropzoneId: Int!\n    $userId: Int!\n  ) {\n    dropzone(id: $dropzoneId) {\n      id\n      dropzoneUser(userId: $userId) {\n        id\n        availableRigs {\n          id\n          make\n          model\n          canopySize\n          serial\n\n          user {\n            id\n          }\n        }\n      }\n    }\n  }\n"])));function b(e){var n,t,l,r,i,o,s,b,g=Object(d.useState)(!1),h=a()(g,2),y=h[0],E=h[1],j=Object(f.l)((function(e){return e.global})),I=Object(u.useLazyQuery)(v),O=a()(I,2),x=O[0],S=O[1].data;return Object(d.useEffect)((function(){var n;e.userId&&e.dropzoneId&&x({variables:{dropzoneId:Number(null==(n=j.currentDropzone)?void 0:n.id),userId:Number(e.userId)}})}),[e.userId,e.dropzoneId]),Object(d.useEffect)((function(){var n,t,l;!e.value&&e.autoSelectFirst&&null!=S&&null!=(n=S.dropzone)&&null!=(t=n.dropzoneUser)&&null!=(l=t.availableRigs)&&l.length&&e.onSelect(S.dropzone.dropzoneUser.availableRigs[0])}),[e.autoSelectFirst,JSON.stringify(null==S||null==(n=S.dropzone)||null==(t=n.dropzoneUser)?void 0:t.availableRigs)]),c.a.createElement(m.a,{onDismiss:function(){return E(!1)},visible:y,anchor:c.a.createElement(p.b.Item,{onPress:function(){E(!0)},title:e.value?(null==(l=e.value)?void 0:l.make)+" "+(null==(r=e.value)?void 0:r.model)+" ("+((null==(i=e.value)?void 0:i.canopySize)||"?")+"sqft)":"Select rig",description:e.required?null:"Optional",left:function(){return c.a.createElement(p.b.Icon,{icon:"parachute"})}})},null==S||null==(o=S.dropzone)||null==(s=o.dropzoneUser)||null==(b=s.availableRigs)?void 0:b.map((function(n){return c.a.createElement(m.a.Item,{key:"rig-select-"+n.id,onPress:function(){E(!1),e.onSelect(n)},title:(null==n?void 0:n.make)+" "+(null==n?void 0:n.model)+" ("+(null==n?void 0:n.canopySize)+" sqft) "+(n.user?"":"[DROPZONE RIG]")})})))}},495:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var l=t(487),r=t(484),a=t(482);function i(e,n){Object(a.a)(2,arguments);var t=Object(r.a)(e).getTime(),i=Object(l.a)(n);return new Date(t+i)}},536:function(e,n,t){"use strict";t.r(n),t.d(n,"default",(function(){return Fe}));var l=t(6),r=t.n(l),a=t(9),i=t.n(a),o=t(71),u=t.n(o),s=t(49),d=t(40),c=t(484),m=t(482);function p(e){Object(m.a)(1,arguments);var n=Object(c.a)(e);return n.setHours(0,0,0,0),n}var f,v,b=t(72),g=t(0),h=t.n(g),y=t(29),E=t(171),j=t(1),I=t(504),O=t(312),x=t(318),S=t(11),w=t.n(S),k=t(80),z=t(154),T=t(142),N=t(116),P=t(21),$=t(23),C=t.n($),D=t(221),F=t(52),A=t(303),M=t(304),W=t(250),U=t(242),L=t(165),q=Object(b.a)(f||(f=u()(["\n  query JumpTypes($allowedForUserId: Int) {\n    jumpTypes(allowedForUserId: $allowedForUserId) {\n      id\n      name\n    }\n  }\n"])));function J(e){var n,t,l=Object(g.useState)(!1),r=i()(l,2),a=r[0],o=r[1],u=Object(s.useQuery)(q,{variables:{allowedForUserId:e.userId}}),d=u.data;u.loading,u.refetch;return h.a.createElement(h.a.Fragment,null,h.a.createElement(F.b.Subheader,null,"Jump type"),h.a.createElement(L.a,{onDismiss:function(){return o(!1)},visible:a,anchor:h.a.createElement(F.b.Item,{onPress:function(){o(!0)},title:(null==(n=e.value)?void 0:n.name)||"Please select jump type",description:e.required?null:"Optional"})},null==d||null==(t=d.jumpTypes)?void 0:t.map((function(n){return h.a.createElement(L.a.Item,{onPress:function(){o(!1),e.onSelect(n)},title:n.name||"-"})}))))}var R=Object(b.a)(v||(v=u()(["\n  query TicketTypes($allowManifestingSelf: Boolean, $dropzoneId: Int!) {\n    ticketTypes(allowManifestingSelf: $allowManifestingSelf, dropzoneId: $dropzoneId) {\n      id\n      name\n      isTandem\n      cost\n\n      extras {\n        id\n        name\n        cost\n      }\n    }\n  }\n"])));function Q(e){var n,t,l,r=Object(g.useState)(!1),a=i()(r,2),o=a[0],u=a[1],d=Object(P.l)((function(e){return e.global})),c=Object(s.useQuery)(R,{variables:{dropzoneId:Number(null==(n=d.currentDropzone)?void 0:n.id),allowManifestingSelf:e.allowManifestingSelf}}),m=c.data;c.loading,c.refetch;return h.a.createElement(h.a.Fragment,null,h.a.createElement(F.b.Subheader,null,"Ticket"),h.a.createElement(L.a,{onDismiss:function(){return u(!1)},visible:o,anchor:h.a.createElement(F.b.Item,{onPress:function(){u(!0)},title:(null==(t=e.value)?void 0:t.name)||"Please select ticket type",description:e.required?null:"Optional"})},null==m||null==(l=m.ticketTypes)?void 0:l.map((function(n){return h.a.createElement(L.a.Item,{key:"ticket-type-select-"+n.id,onPress:function(){u(!1),e.onSelect(n)},title:n.name||"-"})}))))}var G=t(170),H=t(494),Y=U.a.actions;function B(){var e,n,t,l,r,a,i,o,u,s,d,c,m,p,f,v,b,h,y,E,j,I,O,x,S=Object(P.l)((function(e){return e.slotForm})),w=Object(P.k)(),z=Object(P.l)((function(e){return e.global}));g.useEffect((function(){var e,n;null!=(e=S.fields.user)&&e.value&&(S.fields.exitWeight.value||w(Y.setField(["exitWeight",Number(S.fields.user.value.exitWeight||60)])),!S.fields.rig.value&&null!=(n=S.fields.user.value.rigs)&&n.length&&w(Y.setField(["rig",S.fields.user.value.rigs[0]])))}),[null==(e=S.fields)||null==(n=e.user)||null==(t=n.value)?void 0:t.id]);var T=null==S||null==(l=S.original)?void 0:l.id,N=Object(G.a)(T?"updateUserSlot":"createUserSlot");return g.createElement(g.Fragment,null,g.createElement(J,{value:S.fields.jumpType.value,required:!0,userId:Number(null==S||null==(r=S.fields)||null==(a=r.user)||null==(i=a.value)?void 0:i.id)||null,onSelect:function(e){return w(Y.setField(["jumpType",e]))}}),g.createElement(D.a,{type:S.fields.jumpType.error?"error":"info"},S.fields.jumpType.error||""),g.createElement(Q,{value:S.fields.ticketType.value,required:!0,allowManifestingSelf:!N,onSelect:function(e){return w(Y.setField(["ticketType",e]))}}),g.createElement(D.a,{type:S.fields.ticketType.error?"error":"info"},S.fields.ticketType.error||""),null!=S&&null!=(o=S.fields)&&null!=(u=o.ticketType)&&null!=(s=u.value)&&null!=(d=s.extras)&&d.length?g.createElement(F.b.Subheader,null,"Ticket addons"):null,g.createElement(k.a,{horizontal:!0,style:_.ticketAddons},null==S||null==(c=S.fields)||null==(m=c.ticketType)||null==(p=m.value)||null==(f=p.extras)?void 0:f.map((function(e){var n,t,l,r;return g.createElement(A.a,{selected:null==S||null==(n=S.fields)||null==(t=n.extras.value)?void 0:t.some((function(n){return n.id===e.id})),onPress:null!=S&&null!=(l=S.fields)&&null!=(r=l.extras.value)&&r.some((function(n){return n.id===e.id}))?function(){var n,t;return w(Y.setField(["extras",null==S||null==(n=S.fields)||null==(t=n.extras.value)?void 0:t.filter((function(n){return n.id!==e.id}))]))}:function(){var n,t;return w(Y.setField(["extras",[].concat(C()((null==S||null==(n=S.fields)||null==(t=n.extras)?void 0:t.value)||[]),[e])]))}},e.name+" ($"+e.cost+")")}))),g.createElement(D.a,{type:S.fields.extras.error?"error":"info"},S.fields.extras.error||""),g.createElement(M.a,null),S.fields.user?g.createElement(H.a,{value:S.fields.rig.value,userId:Number(null==(v=S.fields.user)||null==(b=v.value)?void 0:b.id),dropzoneId:Number(null==(h=z.currentDropzone)?void 0:h.id),onSelect:function(e){return w(Y.setField(["jumpType",e]))}}):null,g.createElement(D.a,{type:S.fields.rig.error?"error":"info"},S.fields.rig.error||""),g.createElement(W.a,{style:_.field,mode:"outlined",label:"Exit weight",error:!!S.fields.exitWeight.error,value:(null==(y=S.fields.exitWeight)||null==(E=y.value)?void 0:E.toString())||"",keyboardType:"numbers-and-punctuation",right:function(){return g.createElement(W.a.Affix,{text:"kg"})},onChangeText:function(e){return w(Y.setField(["exitWeight",Number(e)]))}}),g.createElement(D.a,{type:S.fields.exitWeight.error?"error":"info"},S.fields.exitWeight.error||""),null!=(j=S.fields.ticketType.value)&&j.isTandem?g.createElement(g.Fragment,null,g.createElement(F.b.Subheader,null,"Passenger"),g.createElement(W.a,{style:_.field,mode:"outlined",label:"Passenger name",error:!!S.fields.passengerName.error,value:(null==(I=S.fields.passengerName)||null==(O=I.value)?void 0:O.toString())||"",onChangeText:function(e){return w(Y.setField(["passengerName",e]))}}),g.createElement(W.a,{style:_.field,mode:"outlined",label:"Passenger exit weight",error:!!S.fields.passengerExitWeight.error,value:(null==(x=S.fields.passengerExitWeight.value)?void 0:x.toString())||"",onChangeText:function(e){return w(Y.setField(["passengerExitWeight",Number(e)]))}})):null)}var V,_=j.a.create({fields:{flex:1},field:{marginBottom:8},ticketAddons:{marginBottom:8}});function Z(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function K(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?Z(Object(t),!0).forEach((function(n){r()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):Z(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var X=Object(s.gql)(V||(V=u()(["\n  mutation CreateSlot(\n    $jumpTypeId: Int\n    $extraIds: [Int!]\n    $loadId: Int\n    $rigId: Int\n    $ticketTypeId: Int\n    $userId: Int\n    $exitWeight: Float\n    $passengerName: String\n    $passengerExitWeight: Float\n  ) {\n    createSlot(\n      input: {\n        attributes: {\n          jumpTypeId: $jumpTypeId\n          extraIds: $extraIds\n          loadId: $loadId\n          rigId: $rigId\n          ticketTypeId: $ticketTypeId\n          userId: $userId\n          exitWeight: $exitWeight\n          passengerExitWeight: $passengerExitWeight\n          passengerName: $passengerName\n        }\n      }\n    ) {\n      errors\n      fieldErrors {\n        field\n        message\n      }\n      slot {\n        id\n        jumpType {\n          id\n          name\n        }\n        extras {\n          id\n          name\n        }\n        exitWeight\n        load {\n          id\n          name\n          createdAt\n          dispatchAt\n          hasLanded\n          maxSlots\n          isFull\n          isOpen\n          plane {\n            id\n            name\n          }\n          gca {\n            id\n            user {\n              id\n              name\n            }\n          }\n          pilot {\n            id\n            user {\n              id\n              name\n            }\n          }\n          loadMaster {\n            id\n            user {\n              id\n              name\n            }\n          }\n          slots {\n            id\n            createdAt\n            user {\n              id\n              name\n            }\n            passengerName\n            passengerExitWeight\n            ticketType {\n              id\n              name\n              isTandem\n              altitude\n            }\n            jumpType {\n              id\n              name\n            }\n            extras {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function ee(e){var n,t,l,r,a,o=Object(P.k)(),u=Object(P.l)((function(e){return e.slotForm})),d=Object(P.l)((function(e){return e.global})),c=Object(s.useMutation)(X),m=i()(c,2),p=m[0],f=m[1],v=Object(g.useCallback)((function(){var e,n,t=!1;return null!=(e=u.fields.jumpType.value)&&e.id||(t=!0,o(P.h.setFieldError(["jumpType","You must specify the type of jump"]))),null!=(n=u.fields.ticketType.value)&&n.id||(t=!0,o(P.h.setFieldError(["ticketType","You must select a ticket type to manifest"]))),!t}),[JSON.stringify(u.fields)]),b=Object(g.useCallback)((function(){var n,t,l,r,a,i,s,d,c,m,f,b,g,h,y,E,j,I,O,x,S,k,z,T,N;return w.a.async((function($){for(;;)switch($.prev=$.next){case 0:if(v()){$.next=2;break}return $.abrupt("return");case 2:return $.prev=2,$.next=5,w.a.awrap(p({variables:K({jumpTypeId:Number(null==(n=u.fields.jumpType.value)?void 0:n.id),extraIds:null==(t=u.fields.extras)||null==(l=t.value)?void 0:l.map((function(e){var n=e.id;return Number(n)})),loadId:Number(null==(r=u.fields.load.value)?void 0:r.id),rigId:null!=(a=u.fields.rig.value)&&a.id?Number(null==(i=u.fields.rig.value)?void 0:i.id):null,ticketTypeId:Number(null==(s=u.fields.ticketType)||null==(d=s.value)?void 0:d.id),userId:Number(null==(c=u.fields.user)||null==(m=c.value)?void 0:m.id),exitWeight:u.fields.exitWeight.value},null!=(f=u.fields.ticketType.value)&&f.isTandem?{passengerName:null==(b=u.fields.passengerName)?void 0:b.value,passengerExitWeight:null==(g=u.fields.passengerExitWeight)?void 0:g.value}:{})}));case 5:if(z=$.sent,null==(h=z.data)||null==(y=h.createSlot)||null==(E=y.fieldErrors)||E.map((function(e){var n=e.field,t=e.message;switch(n){case"jump_type":return o(P.h.setFieldError(["jumpType",t]));case"load":return o(P.h.setFieldError(["load",t]));case"credits":case"extras":case"extra_ids":return o(P.h.setFieldError(["extras",t]));case"ticket_type":return o(P.h.setFieldError(["ticketType",t]));case"rig":return o(P.h.setFieldError(["rig",t]));case"user":return o(P.h.setFieldError(["user",t]));case"exit_weight":return o(P.h.setFieldError(["exitWeight",t]))}})),null==z||null==(j=z.data)||null==(I=j.createSlot)||null==(O=I.errors)||!O.length){$.next=9;break}return $.abrupt("return",o(P.j.showSnackbar({message:null==z||null==(T=z.data)||null==(N=T.createSlot)?void 0:N.errors[0],variant:"error"})));case 9:null!=(x=z.data)&&null!=(S=x.createSlot)&&null!=(k=S.fieldErrors)&&k.length||e.onSuccess(),$.next=15;break;case 12:$.prev=12,$.t0=$.catch(2),o(P.j.showSnackbar({message:$.t0.message,variant:"error"}));case 15:case"end":return $.stop()}}),null,null,[[2,12]],Promise)}),[JSON.stringify(u.fields),p,e.onSuccess]);return h.a.createElement(z.a,null,h.a.createElement(T.a,{visible:!!e.open,style:{maxHeight:500}},h.a.createElement(O.a,{indeterminate:!0,visible:f.loading,color:d.theme.colors.accent}),h.a.createElement(T.a.Title,null,"Manifest "+(null==u||null==(n=u.fields)||null==(t=n.user)||null==(l=t.value)?void 0:l.name)+" on "+(null==(r=u.fields.load)||null==(a=r.value)?void 0:a.name)),h.a.createElement(T.a.ScrollArea,null,h.a.createElement(k.a,null,h.a.createElement(B,null))),h.a.createElement(T.a.Actions,{style:{justifyContent:"flex-end"}},h.a.createElement(N.a,{onPress:function(){o(P.h.reset()),e.onClose()}},"Cancel"),h.a.createElement(N.a,{onPress:b},"Manifest"))))}var ne=t(486),te=t(36),le=t(286);function re(e){var n=e.hasPlanes,t=e.hasTicketTypes,l=(e.isPublic,Object(le.a)());return g.createElement(te.b,{style:{width:"70%"}},g.createElement(te.a,{style:ae.title},"Set up dropzone"),g.createElement(te.b,{style:ae.separator,lightColor:"#eee",darkColor:"rgba(255,255,255,0.1)"}),g.createElement(F.b.Item,{title:"Create dropzone",left:function(){return g.createElement(F.b.Icon,{color:l.success,icon:"check"})}}),g.createElement(F.b.Item,{title:"Add a plane",left:function(){return n?g.createElement(F.b.Icon,{color:l.success,icon:"check"}):g.createElement(F.b.Icon,{color:l.error,icon:"close"})}}),g.createElement(F.b.Item,{title:"Configure jump tickets",left:function(){return t?g.createElement(F.b.Icon,{color:l.success,icon:"check"}):g.createElement(F.b.Icon,{color:l.error,icon:"close"})}}))}var ae=j.a.create({container:{flex:1,alignItems:"center",justifyContent:"center"},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"}}),ie=t(111),oe=t(33),ue=t(121),se=t(372),de=t(302),ce=t(487),me=t(495);function pe(e,n){Object(m.a)(2,arguments);var t=Object(ce.a)(n);return Object(me.a)(e,6e4*t)}function fe(e,n){Object(m.a)(2,arguments);var t=Object(c.a)(e),l=Object(c.a)(n);return t.getTime()-l.getTime()}var ve;var be,ge=Object(b.a)(ve||(ve=u()(["\n  query QueryDropzoneUsers(\n    $dropzoneId: Int!\n    $permissions: [Permission!]\n  ) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n\n      dropzoneUsers(permissions: $permissions) {\n        edges {\n          node {\n            id\n            role {\n              id\n              name\n            }\n            user {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function he(e){var n,t,l,r,a,o,u,d=Object(g.useState)(!1),c=i()(d,2),m=c[0],p=c[1],f=Object(P.l)((function(e){return e.global})),v=Object(s.useQuery)(ge,{variables:{dropzoneId:Number(null==(n=f.currentDropzone)?void 0:n.id),permissions:["actAsGCA"]}}).data;return Object(G.a)("updateLoad")?h.a.createElement(L.a,{onDismiss:function(){return p(!1)},visible:m,anchor:h.a.createElement(A.a,{mode:"outlined",icon:"radio-handheld",style:{marginHorizontal:4},onPress:function(){return p(!0)}},null!=(l=e.value)&&l.id?null==(r=e.value)?void 0:r.name:"No gca")},null==v||null==(a=v.dropzone)||null==(o=a.dropzoneUsers)||null==(u=o.edges)?void 0:u.map((function(n){var t,l,r;return h.a.createElement(L.a.Item,{key:"gca-chip-"+(null==n||null==(t=n.node)?void 0:t.id),onPress:function(){var t;p(!1),e.onSelect(null==n||null==(t=n.node)?void 0:t.user)},title:null==n||null==(l=n.node)||null==(r=l.user)?void 0:r.name})}))):h.a.createElement(A.a,{mode:"outlined",icon:"radio-handheld"},(null==(t=e.value)?void 0:t.name)||"No gca")}function ye(e){var n,t,l,r,a=Object(g.useState)(!1),o=i()(a,2),u=o[0],s=o[1],d=Object(G.a)("updateLoad");return d?h.a.createElement(L.a,{onDismiss:function(){return s(!1)},visible:u,anchor:h.a.createElement(A.a,{mode:"outlined",icon:"parachute",style:{marginHorizontal:4},onPress:function(){return d&&s(!0)}},null!=(t=e.value)&&t.id?null==(l=e.value)?void 0:l.name:"No loadmaster")},null==(r=e.slots)?void 0:r.map((function(n){var t;return h.a.createElement(L.a.Item,{key:"lm-chip-"+n.id,onPress:function(){s(!1),e.onSelect(n.user)},title:null==n||null==(t=n.user)?void 0:t.name})}))):h.a.createElement(A.a,{mode:"outlined",icon:"radio-handheld"},(null==(n=e.value)?void 0:n.name)||"No loadmaster")}var Ee,je=Object(b.a)(be||(be=u()(["\n  query QueryDropzoneUsers(\n    $dropzoneId: Int!\n    $permissions: [Permission!]\n  ) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n\n      dropzoneUsers(permissions: $permissions) {\n        edges {\n          node {\n            id\n            role {\n              id\n              name\n            }\n            user {\n              id\n              name\n            }\n          }\n        }\n      }\n    }\n  }\n"])));function Ie(e){var n,t,l,r,a,o,u,d=Object(g.useState)(!1),c=i()(d,2),m=c[0],p=c[1],f=Object(P.l)((function(e){return e.global})),v=Object(s.useQuery)(je,{variables:{dropzoneId:Number(null==(n=f.currentDropzone)?void 0:n.id),permissions:["actAsPilot"]}}).data;return Object(G.a)("updateLoad")?h.a.createElement(L.a,{onDismiss:function(){return p(!1)},visible:m,anchor:h.a.createElement(A.a,{mode:"outlined",icon:"airplane-takeoff",style:{marginHorizontal:4},onPress:function(){return p(!0)}},null!=(l=e.value)&&l.id?null==(r=e.value)?void 0:r.name:"No pilot")},null==v||null==(a=v.dropzone)||null==(o=a.dropzoneUsers)||null==(u=o.edges)?void 0:u.map((function(n){var t,l;return h.a.createElement(L.a.Item,{key:"pilot-select-"+n.node.id,onPress:function(){var t;p(!1),e.onSelect(null==n||null==(t=n.node)?void 0:t.user)},title:null==n||null==(t=n.node)||null==(l=t.user)?void 0:l.name})}))):h.a.createElement(A.a,{mode:"outlined",icon:"radio-handheld"},(null==(t=e.value)?void 0:t.name)||"No pilot")}var Oe,xe,Se=Object(b.a)(Ee||(Ee=u()(["\n  query QueryPlanes(\n    $dropzoneId: Int!\n  ) {\n    planes(dropzoneId: $dropzoneId) {\n      id\n      name\n      registration\n      hours\n      minSlots\n      maxSlots\n      nextMaintenanceHours\n      createdAt\n    }\n  }\n"])));function we(e){var n,t,l,r,a=Object(g.useState)(!1),o=i()(a,2),u=o[0],d=o[1],c=Object(P.l)((function(e){return e.global})),m=Object(s.useQuery)(Se,{variables:{dropzoneId:Number(null==(n=c.currentDropzone)?void 0:n.id)}}).data,p=Object(G.a)("updateLoad");return p?h.a.createElement(L.a,{onDismiss:function(){return d(!1)},visible:u,anchor:h.a.createElement(A.a,{mode:"outlined",icon:"airplane",style:{marginHorizontal:4},onPress:function(){return p&&d(!0)}},(null==(l=e.value)?void 0:l.name)||"No plane")},null==m||null==(r=m.planes)?void 0:r.map((function(n){return h.a.createElement(L.a.Item,{key:"lm-plane-chip-"+n.id,onPress:function(){d(!1),e.onSelect(n)},title:n.name})}))):h.a.createElement(A.a,{mode:"outlined",icon:"airplane-takeoff"},(null==(t=e.value)?void 0:t.name)||"No plane")}var ke=Object(s.gql)(Oe||(Oe=u()(["\n  query QueryLoad($id: Int!) {\n    load(id: $id) {\n      id\n      name\n      createdAt\n      dispatchAt\n      hasLanded\n      maxSlots\n      loadNumber\n      isFull\n      isOpen\n      plane {\n        id\n        name\n      }\n      gca {\n        id\n        user {\n          id\n          name\n        }\n      }\n      pilot {\n        id\n        user {\n          id\n          name\n        }\n      }\n      loadMaster {\n        id\n        user {\n          id\n          name\n        }\n      }\n      slots {\n        id\n        createdAt\n        exitWeight\n        passengerName\n        passengerExitWeight\n        user {\n          id\n          name\n        }\n        ticketType {\n          id\n          name\n          altitude\n          isTandem\n\n          extras {\n            id\n            name\n            cost\n          }\n        }\n        jumpType {\n          id\n          name\n        }\n        extras {\n          id\n          name\n        }\n      }\n    }\n  }\n"]))),ze=Object(s.gql)(xe||(xe=u()(["\n  mutation UpdateLoad(\n    $id: Int!,\n    $pilotId: Int,\n    $gcaId: Int,\n    $planeId: Int,\n    $isOpen: Boolean,\n    $loadMasterId: Int,\n    $dispatchAt: Int,\n    $hasLanded: Boolean,\n  ){\n    updateLoad(input: {\n      id: $id\n      attributes: {\n        pilotId: $pilotId,\n        gcaId: $gcaId,\n        planeId: $planeId,\n        isOpen: $isOpen,\n        loadMasterId: $loadMasterId\n        dispatchAt: $dispatchAt\n        hasLanded: $hasLanded\n      }\n    }) {\n      load {\n        id\n        name\n        createdAt\n        loadNumber\n        dispatchAt\n        hasLanded\n        maxSlots\n        isFull\n        isOpen\n        plane {\n          id\n          name\n        }\n        gca {\n          id\n          user {\n            id\n            name\n          }\n        }\n        pilot {\n          id\n          user {\n            id\n            name\n          }\n        }\n        loadMaster {\n          id\n          user {\n            id\n            name\n          }\n        }\n        slots {\n          id\n          createdAt\n          exitWeight\n\n          passengerName\n          passengerExitWeight\n\n          user {\n            id\n            name\n          }\n          ticketType {\n            id\n            name\n            altitude\n            isTandem\n          }\n          jumpType {\n            id\n            name\n          }\n          extras {\n            id\n            name\n          }\n        }\n      }\n    }\n  }\n"])));function Te(e){var n,t,l,r,a,o,u,c,p,f,v,b,h,y,E,j,I,x,S,z,T,$,C,D,F,A,M,W,U,q,J,R=Object(P.l)((function(e){return e.global})),Q=Object(P.k)(),H=g.useState(!1),Y=i()(H,2),B=Y[0],V=Y[1],_=g.useState(!1),Z=i()(_,2),K=Z[0],X=Z[1],ee=(Object(G.a)("createUserSlot"),Object(d.useNavigation)()),ne=e.load,le=(e.loadNumber,e.onManifest),re=e.canManifest,ae=Object(s.useQuery)(ke,{variables:{id:Number(ne.id)}}),ce=ae.data,me=ae.loading,ve=Object(s.useMutation)(ze),be=i()(ve,2),ge=be[0],Ee=be[1],je=g.useCallback((function(e){return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.a.awrap(ge({variables:{id:Number(ne.id),pilotId:Number(e.id)}}));case 3:n.next=7;break;case 5:n.prev=5,n.t0=n.catch(0);case 7:case"end":return n.stop()}}),null,null,[[0,5]],Promise)}),[ge,JSON.stringify(ne)]),Oe=g.useCallback((function(e){return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.a.awrap(ge({variables:{id:Number(ne.id),gcaId:Number(e.id)}}));case 3:n.next=7;break;case 5:n.prev=5,n.t0=n.catch(0);case 7:case"end":return n.stop()}}),null,null,[[0,5]],Promise)}),[ge,JSON.stringify(ne)]),xe=g.useCallback((function(e){return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.a.awrap(ge({variables:{id:Number(ne.id),planeId:Number(e.id)}}));case 3:n.next=7;break;case 5:n.prev=5,n.t0=n.catch(0);case 7:case"end":return n.stop()}}),null,null,[[0,5]],Promise)}),[ge,JSON.stringify(ne)]),Se=g.useCallback((function(e){return w.a.async((function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,w.a.awrap(ge({variables:{id:Number(ne.id),loadMasterId:Number(e.id)}}));case 3:n.next=7;break;case 5:n.prev=5,n.t0=n.catch(0);case 7:case"end":return n.stop()}}),null,null,[[0,5]],Promise)}),[ge,JSON.stringify(ne)]),Te=g.useCallback((function(e){var n;return w.a.async((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e?pe(new Date,e).getTime()/1e3:null,t.prev=1,t.next=4,w.a.awrap(ge({variables:{id:Number(ne.id),dispatchAt:n?Math.ceil(n):null}}));case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:case"end":return t.stop()}}),null,null,[[1,6]],Promise)}),[ge,JSON.stringify(ne)]),Ne=g.useCallback((function(){return w.a.async((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.a.awrap(ge({variables:{id:Number(ne.id),hasLanded:!0}}));case 3:e.next=7;break;case 5:e.prev=5,e.t0=e.catch(0);case 7:case"end":return e.stop()}}),null,null,[[0,5]],Promise)}),[ge,JSON.stringify(ne)]),$e=Object(G.a)("updateLoad"),Ce=Object(G.a)("updateSlot"),De=Object(G.a)("updateUserSlot");return g.useEffect((function(){var e,n;null!=ce&&null!=(e=ce.load)&&e.maxSlots&&(null==ce||null==(n=ce.load)?void 0:n.maxSlots)<5&&!B&&V(!0)}),[null==ce||null==(n=ce.load)?void 0:n.maxSlots]),g.createElement(ie.a,{style:{margin:16,opacity:null!=ce&&null!=(t=ce.load)&&t.hasLanded?.5:1},elevation:3},g.createElement(ie.a.Title,{style:{justifyContent:"space-between"},title:g.createElement(te.b,{style:{width:"100%",flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},g.createElement(oe.a,null,"Load "+((null==ce||null==(l=ce.load)?void 0:l.loadNumber)||0)),g.createElement(te.b,{style:{flexGrow:1}}),!(null!=ce&&null!=(r=ce.load)&&r.hasLanded)&&(!(null!=ce&&null!=(a=ce.load)&&a.dispatchAt)||(null==ce?void 0:ce.load.dispatchAt)>(new Date).getTime()/1e3)&&g.createElement(ue.a,{icon:"account-group",onPress:function(){var e;Q(P.i.reset()),Q(P.i.setField(["load",ne])),ee.navigate("ManifestGroupUserSelectScreen",{loadId:null==ce||null==(e=ce.load)?void 0:e.id})}})),subtitle:ne.name}),g.createElement(O.a,{visible:me||Ee.loading,color:R.theme.colors.accent}),g.createElement(ie.a.Content,{style:{marginVertical:8,height:B?void 0:300,overflow:"hidden"}},g.createElement(te.b,{style:{flexDirection:"row"}},g.createElement(k.a,{horizontal:!0},g.createElement(we,{dropzoneId:Number(null==(o=R.currentDropzone)?void 0:o.id),value:null==ce||null==(u=ce.load)?void 0:u.plane,onSelect:xe}),g.createElement(he,{dropzoneId:Number(null==(c=R.currentDropzone)?void 0:c.id),value:null==ce||null==(p=ce.load)||null==(f=p.gca)?void 0:f.user,onSelect:Oe}),g.createElement(Ie,{dropzoneId:Number(null==(v=R.currentDropzone)?void 0:v.id),value:null==ce||null==(b=ce.load)||null==(h=b.pilot)?void 0:h.user,onSelect:je}),g.createElement(ye,{dropzoneId:Number(null==(y=R.currentDropzone)?void 0:y.id),value:null==ce||null==(E=ce.load)||null==(j=E.loadMaster)?void 0:j.user,slots:(null==ce?void 0:ce.load.slots)||[],onSelect:Se}))),g.createElement(se.a,null,g.createElement(se.a.Header,{style:{width:"100%"}},g.createElement(se.a.Title,null,"Name"),g.createElement(se.a.Title,{numeric:!0},"Jump type"),g.createElement(se.a.Title,{numeric:!0},"Altitude")),null==ce||null==(I=ce.load)||null==(x=I.slots)?void 0:x.map((function(n){var t,l,r,a,i,o,u=null==ce||null==(t=ce.load)||null==(l=t.slots)?void 0:l.filter((function(e){var t=e.groupNumber;return t&&t===n.groupNumber}));return g.createElement(se.a.Row,{key:"slot-"+n.id,disabled:null==ce||null==(r=ce.load)?void 0:r.hasLanded,onPress:function(){var t,l;(null==(t=n.user)?void 0:t.id)===(null==(l=R.currentUser)?void 0:l.id)?Ce&&(null!=u&&u.length?e.onSlotGroupPress(u):e.onSlotPress(n)):De&&(null!=u&&u.length?e.onSlotGroupPress(u):e.onSlotPress(n))},pointerEvents:"none"},g.createElement(se.a.Cell,null,g.createElement(de.a,{style:Pe.slotText},null==n||null==(a=n.user)?void 0:a.name)),g.createElement(se.a.Cell,{numeric:!0},g.createElement(de.a,{style:Pe.slotText},null==n||null==(i=n.jumpType)?void 0:i.name)),g.createElement(se.a.Cell,{numeric:!0},g.createElement(de.a,{style:Pe.slotText},((null==n||null==(o=n.ticketType)?void 0:o.altitude)||14e3)/1e3,"k")))})),Array.from({length:((null==ce||null==(S=ce.load)?void 0:S.maxSlots)||0)-((null==ce||null==(z=ce.load)||null==(T=z.slots)?void 0:T.length)||0)},(function(e,n){return n})).map((function(e){return g.createElement(se.a.Row,{key:ne.id+"-empty-slot-"+e},g.createElement(se.a.Cell,null,g.createElement(de.a,{style:Pe.slotText},"- Available -")),g.createElement(se.a.Cell,{numeric:!0},"-"),g.createElement(se.a.Cell,{numeric:!0},"-"))})))),!(null==ce||null==($=ce.load)||!$.dispatchAt)&&(null==ce||null==(C=ce.load)?void 0:C.dispatchAt)>(new Date).getTime()/1e3&&g.createElement(te.b,{style:{flex:1,backgroundColor:"#FF8800",padding:8}},g.createElement(de.a,null,"Take-off in "+function(e,n){Object(m.a)(2,arguments);var t=fe(e,n)/6e4;return t>0?Math.floor(t):Math.ceil(t)}(new Date,1e3*(null==ce||null==(D=ce.load)?void 0:D.dispatchAt))+" min")),g.createElement(ie.a.Actions,null,null!=ce&&null!=(F=ce.load)&&F.maxSlots&&(null==ce||null==(A=ce.load)?void 0:A.maxSlots)<5?null:g.createElement(N.a,{onPress:function(){return V(!B)}},B?"Show less":"Show more"),g.createElement(te.b,{style:{flexGrow:1}}),!$e||null!=ce&&null!=(M=ce.load)&&M.hasLanded?null:null!=ce&&null!=(W=ce.load)&&W.dispatchAt?g.createElement(N.a,{mode:"outlined",onPress:function(){return Te(null)}},"Cancel"):g.createElement(L.a,{onDismiss:function(){return X(!1)},visible:K,anchor:g.createElement(N.a,{mode:"outlined",onPress:function(){return X(!0)}},"Dispatch")},g.createElement(L.a.Item,{onPress:function(){X(!1),Te(20)},title:"20 minute call"}),g.createElement(L.a.Item,{onPress:function(){X(!1),Te(15)},title:"15 minute call"}),g.createElement(L.a.Item,{onPress:function(){X(!1),Te(10)},title:"10 minute call"}),g.createElement(L.a.Item,{onPress:function(){X(!1),Te(5)},title:"5 minute call"})),null!=ce&&null!=(U=ce.load)&&U.hasLanded?null:null!=ce&&null!=(q=ce.load)&&q.dispatchAt&&(null==ce?void 0:ce.load.dispatchAt)<(new Date).getTime()/1e3&&$e?g.createElement(N.a,{style:{marginLeft:8},mode:"contained",onPress:function(){return Ne()}},"Mark as landed"):g.createElement(N.a,{style:{marginLeft:8},mode:"contained",onPress:function(){return le()},disabled:!re||Boolean((null==ce||null==(J=ce.load)?void 0:J.dispatchAt)&&ce.load.dispatchAt<(new Date).getTime()/1e3)},"Manifest")))}var Ne,Pe=j.a.create({container:{flex:1,alignItems:"center",justifyContent:"center",marginVertical:8},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"},slotText:{fontSize:12},fab:{position:"absolute",margin:16,right:0,bottom:0}});function $e(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);n&&(l=l.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,l)}return t}function Ce(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?$e(Object(t),!0).forEach((function(n){r()(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):$e(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}var De=Object(b.a)(Ne||(Ne=u()(["\n  query QueryDropzone($dropzoneId: Int!, $earliestTimestamp: Int) {\n    dropzone(id: $dropzoneId) {\n      id\n      name\n      primaryColor,\n      secondaryColor,\n      planes {\n        id\n        name\n        registration\n      }\n      ticketTypes {\n        id\n        name\n      }\n\n      currentUser {\n        id\n        hasCredits\n        hasExitWeight\n        hasMembership\n        hasReserveInDate\n        hasRigInspection\n        hasLicense\n\n        transactions {\n          edges {\n            node {\n              id\n              status\n              amount\n            }\n          }\n        }\n\n        user {\n          id\n          name\n          exitWeight\n          email\n          phone\n\n          rigs {\n            id\n            model\n            make\n            serial\n            canopySize\n            repackExpiresAt\n          }\n          jumpTypes {\n            id\n            name\n          }\n          license {\n            id\n            name\n          }\n        }\n      }\n\n      loads(earliestTimestamp: $earliestTimestamp) {\n        edges {\n          node {\n            id\n            name\n            loadNumber\n            isOpen\n            maxSlots\n            isFull\n          }\n        }\n      }\n    }\n  }\n"])));function Fe(){var e,n,t,l,r,a,o,u,c,m,f,v,b,h,j=Object(P.l)((function(e){return e.global})),S=g.useState(!1),w=i()(S,2),k=w[0],z=w[1],T=Object(P.k)(),N=Object(s.useQuery)(De,{variables:{dropzoneId:Number(null==(e=j.currentDropzone)?void 0:e.id),earliestTimestamp:p(new Date).getTime()/1e3},fetchPolicy:"no-cache"}),$=N.data,C=N.loading,D=N.refetch,F=Object(d.useNavigation)(),A=Object(d.useIsFocused)();g.useEffect((function(){A&&D()}),[A]);var M=!(null==$||null==(n=$.dropzone)||null==(t=n.planes)||!t.length),W=!(null==$||null==(l=$.dropzone)||null==(r=l.ticketTypes)||!r.length),U=!(null==$||null==(a=$.dropzone)||!a.isPublic),L=M&&W;g.useEffect((function(){var e,n;null!=$&&null!=(e=$.dropzone)&&e.id&&(T(P.c.setDropzone($.dropzone)),T(P.c.setUser(Ce(Ce({},null==j?void 0:j.currentUser),(null==$||null==(n=$.dropzone)?void 0:n.currentUser.user)||{}))))}),[JSON.stringify(null==$?void 0:$.dropzone)]),g.useEffect((function(){var e,n,t,l,r,a,i,o;null!=$&&null!=(e=$.dropzone)&&e.primaryColor&&(null==$||null==(n=$.dropzone)?void 0:n.primaryColor)!==(null==(t=j.theme)||null==(l=t.colors)?void 0:l.primary)&&T(P.c.setPrimaryColor($.dropzone.primaryColor)),null!=$&&null!=(r=$.dropzone)&&r.secondaryColor&&(null==$||null==(a=$.dropzone)?void 0:a.secondaryColor)!==(null==(i=j.theme)||null==(o=i.colors)?void 0:o.accent)&&T(P.c.setPrimaryColor($.dropzone.secondaryColor))}),[null==$||null==(o=$.dropzone)?void 0:o.primaryColor,null==$||null==(u=$.dropzone)?void 0:u.secondaryColor]);var q=Object(G.a)("createSlot"),J=Object(G.a)("createLoad"),R=g.useCallback((function(e){var n=$.dropzone.currentUser;return n.hasLicense?n.hasMembership?n.hasRigInspection?n.hasReserveInDate?n.hasExitWeight?n.hasCredits?(T(P.h.setField(["user",j.currentUser])),T(P.h.setField(["load",e])),void z(!0)):T(P.j.showSnackbar({message:"You have no credits on your account",variant:"warning"})):T(P.j.showSnackbar({message:"Update your exit weight on your profile before manifesting",variant:"warning"})):T(P.j.showSnackbar({message:"Your rig needs a reserve repack",variant:"warning"})):T(P.j.showSnackbar({message:"Your rig needs to be inspected before manifesting",variant:"warning"})):T(P.j.showSnackbar({message:"Your membership is out of date",variant:"warning"})):T(P.j.showSnackbar({message:"You need to select a license on your user profile",variant:"warning"}))}),[JSON.stringify(null==$||null==(c=$.dropzone)?void 0:c.currentUser)]);return g.createElement(g.Fragment,null,g.createElement(ee,{open:k,onClose:function(){return z(!1)},onSuccess:function(){return z(!1)}}),g.createElement(O.a,{visible:C,indeterminate:!0,color:j.theme.colors.accent}),g.createElement(te.b,{style:Ae.container},!C&&(L?g.createElement(te.b,{style:{width:"100%",flex:1,height:y.a.get("window").height}},((null==$||null==(m=$.dropzone)||null==(f=m.loads)||null==(v=f.edges)?void 0:v.length)||0)<1?g.createElement(ne.a,{title:"No loads so far today",subtitle:"How's the weather?"}):g.createElement(I.a,{style:{flex:1,height:y.a.get("window").height},contentContainerStyle:{flexGrow:1},numColumns:1,data:(null==$||null==(b=$.dropzone)||null==(h=b.loads)?void 0:h.edges)||[],refreshing:C,onRefresh:D,refreshControl:g.createElement(E.a,{refreshing:C,onRefresh:function(){return D()}}),renderItem:function(e){var n,t,l,r,a,i=e.item,o=e.index;return null!=i&&i.node?g.createElement(Te,{key:"load-"+i.node.id,load:i.node,canManifest:q&&(null==i||null==(n=i.node)?void 0:n.isOpen)&&!(null!=i&&null!=(t=i.node)&&t.isFull),loadNumber:((null==$||null==(l=$.dropzone)||null==(r=l.loads)||null==(a=r.edges)?void 0:a.length)||0)-o,onSlotPress:function(e){T(P.h.setOriginal(e)),T(P.h.setField(["load",i.node])),z(!0)},onSlotGroupPress:function(e){T(P.i.reset()),T(P.i.setFromSlots(e)),T(P.i.setField(["load",i.node])),F.navigate("ManifestGroupScreen")},onManifest:function(){return R(i.node)}}):null}})):g.createElement(re,{hasPlanes:M,hasTicketTypes:W,isPublic:U})),J&&L&&g.createElement(x.a,{style:Ae.fab,small:!0,icon:"plus",onPress:function(){return F.navigate("CreateLoadScreen")},label:"New load"})))}var Ae=j.a.create({container:{flex:1,alignItems:"center",justifyContent:"center"},title:{fontSize:20,fontWeight:"bold"},separator:{marginVertical:30,height:1,width:"80%"},fab:{position:"absolute",margin:16,right:0,bottom:0}})}}]);
//# sourceMappingURL=8.a0e9258b.chunk.js.map